# Visual User Journey Guide

> **Follow each flow visually from start to finish with ASCII diagrams.**

This guide maps every user interaction with the BitFlow Finance protocol. Each flow shows the exact sequence of steps, on-chain actions, and state changes.

---

## Overview: The Four Core Flows

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  BitFlow     â”‚
                        â”‚  Protocol    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼          â–¼               â–¼          â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ DEPOSIT  â”‚ â”‚ BORROW   â”‚ â”‚  REPAY   â”‚ â”‚ WITHDRAW â”‚
      â”‚   Flow   â”‚ â”‚   Flow   â”‚ â”‚   Flow   â”‚ â”‚   Flow   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚            â”‚             â”‚            â”‚
           â–¼            â–¼             â–¼            â–¼
      Add STX to    Take loan    Return loan   Remove STX
      collateral    vs deposit   + interest    from vault
```

---

## Flow 1: Deposit

**Goal:** Add STX to your vault as collateral.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    DEPOSIT FLOW                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User                    Frontend                  Contract
  â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                         â”‚                         â”‚
   â”‚  1. Enter amount        â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  2. Validate             â”‚
   â”‚                         â”‚  â€¢ Amount > 0?           â”‚
   â”‚                         â”‚  â€¢ Sufficient balance?   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  3. Click "Deposit"     â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  4. Wallet popup        â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  5. Confirm TX          â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚  6. contract-call        â”‚
   â”‚                         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚                 7. Checks:
   â”‚                         â”‚                 â€¢ amount > 0
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚                 8. Actions:
   â”‚                         â”‚                 â€¢ stx-transfer!
   â”‚                         â”‚                 â€¢ update user-deposits map
   â”‚                         â”‚                 â€¢ increment total-deposits
   â”‚                         â”‚                 â€¢ increment counter
   â”‚                         â”‚                 â€¢ add to volume
   â”‚                         â”‚                 â€¢ update last-activity
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  9. (ok true)            â”‚
   â”‚                         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  10. Success toast      â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  11. Updated balance    â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â–¼                         â–¼                         â–¼
```

### State Changes After Deposit

```
  Before                          After
  â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€
  user-deposits[Alice] = 0        user-deposits[Alice] = 5,000,000
  total-deposits = 10,000,000     total-deposits = 15,000,000
  deposit-count = 3               deposit-count = 4
  deposit-volume = 30,000,000     deposit-volume = 35,000,000
  Alice wallet = 10.50 STX        Alice wallet = 5.50 STX
```

---

## Flow 2: Borrow

**Goal:** Take a loan against your deposited collateral.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    BORROW FLOW                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User                    Frontend                  Contract
  â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                         â”‚                         â”‚
   â”‚  1. Enter borrow amount â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  2. Select term         â”‚                         â”‚
   â”‚     (7/30/90/365 days)  â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  3. Set interest rate   â”‚                         â”‚
   â”‚     (e.g., 500 = 5%)    â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  4. Pre-flight check     â”‚
   â”‚                         â”‚  â€¢ Has existing loan?    â”‚
   â”‚                         â”‚  â€¢ Enough collateral?    â”‚
   â”‚                         â”‚  â€¢ Rate valid (â‰¤100%)?   â”‚
   â”‚                         â”‚  â€¢ Term valid (1-365)?   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  5. Click "Borrow"      â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  6. Wallet popup        â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  7. Confirm TX          â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚  8. contract-call        â”‚
   â”‚                         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚           9. Validations:
   â”‚                         â”‚           â€¢ rate â‰¤ 10000
   â”‚                         â”‚           â€¢ term 1..365
   â”‚                         â”‚           â€¢ no existing loan
   â”‚                         â”‚           â€¢ deposit â‰¥ 150%
   â”‚                         â”‚             of borrow
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚           10. Actions:
   â”‚                         â”‚           â€¢ stx-transfer!
   â”‚                         â”‚             (vault â†’ user)
   â”‚                         â”‚           â€¢ store loan data
   â”‚                         â”‚           â€¢ increment counter
   â”‚                         â”‚           â€¢ add to volume
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  11. (ok true)           â”‚
   â”‚                         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  12. Loan active card   â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â–¼                         â–¼                         â–¼
```

### Collateral Check Diagram

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚         COLLATERAL RATIO CHECK              â”‚
  â”‚                                             â”‚
  â”‚  deposit = 5,000,000 (5 STX)                â”‚
  â”‚  borrow  = 3,000,000 (3 STX)               â”‚
  â”‚                                             â”‚
  â”‚  required = borrow Ã— 150 / 100              â”‚
  â”‚          = 3,000,000 Ã— 150 / 100            â”‚
  â”‚          = 4,500,000 (4.5 STX)              â”‚
  â”‚                                             â”‚
  â”‚  deposit (5,000,000) >= required (4,500,000) â”‚
  â”‚  â”€â”€â–º âœ“ PASS                                 â”‚
  â”‚                                             â”‚
  â”‚  If borrow = 3,500,000 (3.5 STX):           â”‚
  â”‚  required = 5,250,000 (5.25 STX)            â”‚
  â”‚  deposit (5,000,000) < required (5,250,000)  â”‚
  â”‚  â”€â”€â–º âœ— FAIL (ERR-INSUFFICIENT-COLLATERAL)   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Loan Data Stored On-Chain

```
  user-loans[Alice] = {
    amount:        3,000,000    â† principal (3 STX)
    interest-rate:       500    â† 5% APR in basis points
    start-block:     180,000    â† block when borrowed
    term-end:        180,000 + (30 Ã— 144) = 184,320
                                â† due in 30 days
  }
```

---

## Flow 3: Repay

**Goal:** Repay your loan (principal + interest) and unlock your collateral.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                    REPAY FLOW                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User                    Frontend                  Contract
  â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                         â”‚                         â”‚
   â”‚  1. View loan details   â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚  2. Fetch repayment     â”‚
   â”‚                         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  3. Calculate:           â”‚
   â”‚                         â”‚  interest =              â”‚
   â”‚                         â”‚    principal Ã— rate Ã—    â”‚
   â”‚                         â”‚    blocks / (100Ã—52560)  â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  4. Return amounts       â”‚
   â”‚                         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  5. See breakdown:      â”‚                         â”‚
   â”‚     Principal: 3.00     â”‚                         â”‚
   â”‚     Interest:  0.012    â”‚                         â”‚
   â”‚     Total:     3.012    â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  6. Click "Repay"       â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  7. Wallet popup        â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  8. Confirm TX          â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚  9. contract-call        â”‚
   â”‚                         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚           10. Actions:
   â”‚                         â”‚           â€¢ calc interest
   â”‚                         â”‚           â€¢ stx-transfer!
   â”‚                         â”‚             (user â†’ vault)
   â”‚                         â”‚           â€¢ delete loan
   â”‚                         â”‚           â€¢ add to total-
   â”‚                         â”‚             repaid
   â”‚                         â”‚           â€¢ update counters
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  11. (ok {              â”‚
   â”‚                         â”‚    principal, interest,  â”‚
   â”‚                         â”‚    total                 â”‚
   â”‚                         â”‚  })                      â”‚
   â”‚                         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  12. Loan cleared!      â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â–¼                         â–¼                         â–¼
```

### Interest Calculation Example

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚           INTEREST CALCULATION               â”‚
  â”‚                                              â”‚
  â”‚  Principal:    3,000,000 microSTX (3 STX)    â”‚
  â”‚  Rate:         500 basis points (5% APR)     â”‚
  â”‚  Elapsed:      4,320 blocks (30 days)        â”‚
  â”‚                                              â”‚
  â”‚  interest = principal Ã— rate Ã— blocks        â”‚
  â”‚             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
  â”‚                   100 Ã— 52,560               â”‚
  â”‚                                              â”‚
  â”‚           = 3,000,000 Ã— 500 Ã— 4,320          â”‚
  â”‚             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
  â”‚                   5,256,000                   â”‚
  â”‚                                              â”‚
  â”‚           = 6,480,000,000,000                 â”‚
  â”‚             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
  â”‚                 5,256,000                     â”‚
  â”‚                                              â”‚
  â”‚           = 1,232,876 microSTX               â”‚
  â”‚           â‰ˆ 1.23 STX                         â”‚
  â”‚                                              â”‚
  â”‚  Total repayment = 3,000,000 + 1,232,876     â”‚
  â”‚                  = 4,232,876 microSTX         â”‚
  â”‚                  â‰ˆ 4.23 STX                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flow 4: Withdraw

**Goal:** Remove your STX from the vault back to your wallet.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                   WITHDRAW FLOW                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User                    Frontend                  Contract
  â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                         â”‚                         â”‚
   â”‚  1. Enter amount        â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  2. Validate             â”‚
   â”‚                         â”‚  â€¢ Has active loan?      â”‚
   â”‚                         â”‚    â†’ Cannot withdraw     â”‚
   â”‚                         â”‚  â€¢ Amount â‰¤ deposit?     â”‚
   â”‚                         â”‚                         â”‚
   â”‚  3. Click "Withdraw"    â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  4. Wallet popup        â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  5. Confirm TX          â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚  6. contract-call        â”‚
   â”‚                         â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚           7. Checks:
   â”‚                         â”‚           â€¢ amount > 0
   â”‚                         â”‚           â€¢ amount â‰¤ balance
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚           8. Actions:
   â”‚                         â”‚           â€¢ stx-transfer!
   â”‚                         â”‚             (vault â†’ user)
   â”‚                         â”‚           â€¢ update deposits
   â”‚                         â”‚           â€¢ decrement total
   â”‚                         â”‚           â€¢ update counters
   â”‚                         â”‚                         â”‚
   â”‚                         â”‚  9. (ok true)            â”‚
   â”‚                         â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  10. Balance updated    â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â–¼                         â–¼                         â–¼
```

---

## Flow 5: Liquidation

**Goal:** A third party liquidates an undercollateralized loan.

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                  LIQUIDATION FLOW                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Liquidator               Contract                 Borrower
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                         â”‚                         â”‚
   â”‚  1. Check health factor â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  2. health < 110%?      â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  Yes â†’ proceed          â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚  3. Call liquidate       â”‚                         â”‚
   â”‚     (borrower, price)   â”‚                         â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                         â”‚
   â”‚                         â”‚                         â”‚
   â”‚                   4. Validations:                  â”‚
   â”‚                   â€¢ Not self-liquidation           â”‚
   â”‚                   â€¢ Has active loan               â”‚
   â”‚                   â€¢ Health < 110%                  â”‚
   â”‚                         â”‚                         â”‚
   â”‚                   5. Calculate:                    â”‚
   â”‚                   â€¢ interest owed                  â”‚
   â”‚                   â€¢ total debt                     â”‚
   â”‚                   â€¢ 5% liquidator bonus            â”‚
   â”‚                         â”‚                         â”‚
   â”‚                   6. Actions:                      â”‚
   â”‚                   â€¢ Liquidator pays                â”‚
   â”‚                     (debt + 5% bonus)              â”‚
   â”‚                   â€¢ Seize borrower's               â”‚
   â”‚                     collateral                     â”‚
   â”‚                   â€¢ Delete loan                    â”‚
   â”‚                   â€¢ Reset borrower's               â”‚
   â”‚                     deposit to 0                   â”‚
   â”‚                         â”‚                         â”‚
   â”‚  7. (ok {               â”‚                         â”‚
   â”‚    seized-collateral,   â”‚     8. Loan deleted      â”‚
   â”‚    paid,                â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º      â”‚
   â”‚    bonus                â”‚     Deposit zeroed       â”‚
   â”‚  })                     â”‚                         â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                         â”‚
   â–¼                         â–¼                         â–¼
```

### Liquidation Economics

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚          LIQUIDATION EXAMPLE                 â”‚
  â”‚                                              â”‚
  â”‚  Bob's Position:                             â”‚
  â”‚    Deposit:     5.00 STX (collateral)        â”‚
  â”‚    Loan:        3.50 STX (principal)         â”‚
  â”‚    Interest:    0.10 STX (accrued)           â”‚
  â”‚    Total debt:  3.60 STX                     â”‚
  â”‚                                              â”‚
  â”‚  STX price drops â†’ health factor < 110%      â”‚
  â”‚                                              â”‚
  â”‚  Alice (liquidator) calls liquidate:         â”‚
  â”‚    â€¢ Alice pays: 3.60 + 5% = 3.78 STX       â”‚
  â”‚    â€¢ Alice receives: 5.00 STX (collateral)   â”‚
  â”‚    â€¢ Alice profit: 5.00 - 3.78 = 1.22 STX   â”‚
  â”‚                                              â”‚
  â”‚  Bob's result:                               â”‚
  â”‚    â€¢ Loan deleted                            â”‚
  â”‚    â€¢ Deposit zeroed (collateral seized)      â”‚
  â”‚    â€¢ Keeps the originally borrowed 3.50 STX  â”‚
  â”‚    â€¢ Net loss: 5.00 - 3.50 = 1.50 STX       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete User Lifecycle

```
  â”Œâ”€â”€â”€â”€â”€â”
  â”‚STARTâ”‚
  â””â”€â”€â”¬â”€â”€â”˜
     â”‚
     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Connect Wallet   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Deposit STX      â”‚â”€â”€â”€â”€â–ºâ”‚ Monitor Balance  â”‚â—„â”€â”€â”
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           â”‚                                       â”‚
           â–¼                                       â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
  â”‚ Borrow STX       â”‚                             â”‚
  â”‚ (optional)       â”‚                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
           â”‚                                       â”‚
           â–¼                                       â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚ Monitor Health   â”‚â”€â”€â”€â”€â–ºâ”‚ Add Collateral   â”‚â”€â”€â”€â”˜
  â”‚ Factor           â”‚     â”‚ (if needed)      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Repay Loan       â”‚
  â”‚ (principal +     â”‚
  â”‚  interest)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Withdraw STX     â”‚
  â”‚ (all or partial) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Disconnect or    â”‚
  â”‚ repeat cycle     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Decision Trees

### Should I Borrow?

```
  Do you have STX deposited?
  â”‚
  â”œâ”€ No â”€â”€â–º Deposit first
  â”‚
  â””â”€ Yes â”€â–º Do you have an active loan?
             â”‚
             â”œâ”€ Yes â”€â”€â–º Repay first (1 loan at a time)
             â”‚
             â””â”€ No â”€â”€â–º Is your deposit â‰¥ 150% of borrow?
                        â”‚
                        â”œâ”€ No â”€â”€â–º Deposit more or borrow less
                        â”‚
                        â””â”€ Yes â”€â”€â–º âœ“ You can borrow!
```

### What Should I Do When Health Factor Drops?

```
  Health Factor
  â”‚
  â”œâ”€ > 200% â”€â”€â–º No action needed. You're very safe.
  â”‚
  â”œâ”€ 150-200% â”€â”€â–º Monitor regularly. Consider adding collateral.
  â”‚
  â”œâ”€ 110-150% â”€â”€â–º âš ï¸ WARNING: Add collateral or repay part of loan.
  â”‚
  â””â”€ < 110% â”€â”€â–º ğŸš¨ DANGER: Repay immediately! Liquidation possible.
```

---

## Related Documentation

- [Quick Start Guide](QUICKSTART.md) â€” 5-minute setup
- [Health Factor Guide](HEALTH_FACTOR_GUIDE.md) â€” Understanding health factors
- [Liquidation Guide](LIQUIDATION_GUIDE.md) â€” How liquidation works
- [Interest Calculator](INTEREST_CALCULATOR.md) â€” Calculate your costs
- [API Reference](API.md) â€” Contract function details
